{"name":"node-c2dm","body":"# node-c2dm\r\nAn interface for [Android Cloud to Device Messaging][1] push notification service for Node.js\r\n\r\n## Installation\r\n\r\nVia [npm][4]:\r\n\r\n    $ npm install c2dm\r\n\r\nAs a submodule of your project\r\n\r\n    $ git submodule add http://github.com/SpeCT/node-c2dm.git c2dm\r\n    $ git submodule update --init\r\n\r\n## Usage\r\n### Load in the module\r\n\r\n    var C2DM = require('c2dm').C2DM;\r\n\r\n### Create a connection\r\nSee [Google Client Login documentation][2] for details.\r\n\r\n    var config = {\r\n        user: 'bla-blah-blah@gmail.com',\r\n        password: 'your-huge-very-very-strong-password',\r\n        source: 'com.company.app-name',\r\n    };\r\n    var c2dm = new C2DM(config);\r\n\r\n### Login into c2dm\r\n\r\n    c2dm.login(function(err, token){\r\n        // err - error, received from Google ClientLogin api\r\n        // token - Auth token\r\n    });\r\n    \r\n### Send message to device\r\nSee [C2DM documentation][3] for details.\r\n\r\n    var message = {\r\n        registration_id: 'Device registration id',\r\n        collapse_key: 'Collapse key', // required\r\n        'data.key1': 'value1',\r\n        'data.key2': 'value2',\r\n        delay_while_idle: '1' // remove if not needed\r\n    };\r\n    \r\n    c2dm.send(message, function(err, messageId){\r\n        if (err) {\r\n            console.log(\"Something has gone wrong!\");\r\n        } else {\r\n            console.log(\"Sent with message ID: \", messageId);\r\n        }\r\n    });\r\n\r\n### Avoiding login procedure\r\nYou can avoid the login procedure by manually setting Google ClientLogin Auth token in the connection config.\r\nFirst of all you need to fetch the token by executing the following command. Replace `ROLE_EMAIL`, `ROLE_PASSWORDPASS` and `YOURCOMPANY-YOURAPP-Version` with your data:\r\n\r\n    $ curl -X POST https://www.google.com/accounts/ClientLogin -d Email=ROLE_EMAIL -d Passwd=ROLE_PASSWORDPASS -d accountType=HOSTED_OR_GOOGLE -d service=ac2dm -d source=YOURCOMPANY-YOURAPP-Version\t\r\n\r\nYou will receive three lines. Skip `SID` and `LSID` and copy line starting with `Auth=`. Next include 'token' property into config data and fill it with this `Auth=...` line:\r\n\r\n    var config = {\r\n        token: 'Auth=VVVVEEERY-HUDE-TOKEN',  // N.B. include with Auth= prefix\r\n    };\r\n    var c2dm = new C2DM(config);\r\n\r\nHowever, Google will occaisionally require the token to be updated before further requests can be accepted. If this happens, the `Update-Client-Auth` header will automatically be used to update the current configurations token, but obviously will not be stored on the next reload. A `token` event will be triggered if this happens so you can update a local configuration file, but its probably easier to perform a login each time the application is started:\r\n\r\n    c2dm.on('token', function(err, token) {\r\n      // Do something with the new token\r\n    });\r\n\r\n### Testing sending a message\r\nIf it looks like things aren't going your way, try sending a request manually using the following curl command and see what google sends back to you:\r\n\r\n    $ curl -H \"Authorization: GoogleLogin auth=YOUR-LONG-TOKEN\" -X POST https://android.apis.google.com/c2dm/send -d \"registration_id=DESTINATION-TOKEN\" -d \"collapse_key=key\" -d \"data.event=hire\" -v\r\n\r\nYou should get back the header details along with a message id if sending has been successful. For example:\r\n\r\n    .... sending headers and SSL stuff .....\r\n    < HTTP/1.1 200 OK\r\n    < Content-Type: text/plain\r\n    < Date: Wed, 18 Jan 2012 11:18:01 GMT\r\n    < Expires: Wed, 18 Jan 2012 11:18:01 GMT\r\n    < Cache-Control: private, max-age=0\r\n    < X-Content-Type-Options: nosniff\r\n    < X-Frame-Options: SAMEORIGIN\r\n    < X-XSS-Protection: 1; mode=block\r\n    < Server: GSE\r\n    < Transfer-Encoding: chunked\r\n    <\r\n    id=0:1326885481081626%900b347100019e5f\r\n    .... more SSL stuff ....\r\n\r\n### Keep-alive connection\r\nThis module supports Connection: keep-alive header too keep connection to c2dm gate established. You could use it by simply including property in config:\r\n\r\n    var config = {\r\n        ...\r\n        keepAlive: true,  // it is false by default\r\n    };\r\n\r\n\r\n## Credits\r\n\r\nWritten and maintained by [Yury Proshchenko][5].\r\n\r\n## License\r\n\r\nThe MIT License\r\n\r\nCopyright (c) 2011 Yury Proshchenko (spect.man@gmail.com)\r\n\r\nPermission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the \"Software\"), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:\r\n\r\nThe above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.\r\n\r\n[1]: http://code.google.com/android/c2dm/index.html\r\n[2]: http://code.google.com/apis/accounts/docs/AuthForInstalledApps.html#Request\r\n[3]: http://code.google.com/android/c2dm/index.html#push\r\n[4]: http://github.com/isaacs/npm\r\n[5]: mailto:spect.man@gmail.com\r\n\r\n## Changelog\r\n\r\n1.1.0\r\n\r\n - [#2](http://github.com/SpeCT/node-c2dm/issues/2) â€“ Exponential backoff retry on quota and temporary errors (thanks Olivier Poitrey aka [rs](https://github.com/rs))\r\n - Handle auth_token refresh (Update-Client-Auth header) (thanks [Sam Lown](https://github.com/samlown))\r\n\r\n1.0.4\r\n\r\n  - Handle scenario where 'close' event is emitted before 'end' event (node 0.4.x)\r\n\r\n1.0.3\r\n\r\n  - Converted internal subscription method from on(2) to once(2)\r\n  - Published to npm\r\n\r\n1.0.2\r\n\r\n  - Fixed 'Content-length missing' error\r\n\r\n1.0.1\r\n\r\n  - Fixed package.json (thanks Mohd Faruq aka ruqqq)\r\n  - Fixed 'socked hang up' error (once again thanks Mohd Faruq aka ruqqq)\r\n\r\n1.0.0:\r\n\r\n  - Initial release","tagline":"An interface to the Android Cloud to Device Messaging (C2DM) service for Node.js","google":"UA-31018807-1","note":"Don't delete this file! It's used internally to help with page regeneration."}